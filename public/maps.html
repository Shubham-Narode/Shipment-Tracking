<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <meta charset="utf-8" />

    <style>
      /* Always set the map height explicitly to define the size of the div
         * element that contains the map. */
      #map {
        height: 100%;
      }
      /* Optional: Makes the sample page fill the window. */
      html,
      body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <script>
      
      
      function initMap() {
        const datas = JSON.parse(localStorage.getItem("datas"))
        console.log(datas)
        const trackPoints = JSON.parse(localStorage.getItem("trackPoints"))
        console.log(trackPoints)
        var DataArray = [];
        var DataArray2 = [];
        var pointArray = []

        for (let key in datas.data) {
          for (let word in datas.data[key]) {
            if (word === "latitude" || word === "longitude") {
              DataArray.push(datas.data[key]);
              DataArray2[key] = datas.data[key];
            }
          }
        }


        trackPoints.data.map((point)=>{
          let obj={
            lat:point.latitude,
            lng: point.longitude
          }
          pointArray.push(obj)
        })

        var map = new google.maps.Map(document.getElementById("map"), {
          zoom: 4,
          mapTypeId: "terrain",
          gestureHandling: "cooperative",
          // center: (lat: trackPoints.data[0].latitude ),
          center: new google.maps.LatLng(trackPoints.data[0].latitude , trackPoints.data[0].longitude ),
        });

        // Define the symbol, using one of the predefined paths ('CIRCLE')
        // supplied by the Google Maps JavaScript API.
        var lineSymbol = {
          path: google.maps.SymbolPath.FORWARD_CLOSED_ARROW,
          fillColor: "red",
          scale: 5,
          strokeOpacity: 1.5,
        };

        DataArray.map((data) => {
          let marker = new google.maps.Marker({
            position: { lat: data.latitude, lng: data.longitude },
            map,
          });
        });

          // Create the polyline and add the symbol to it via the 'icons' property.
          // Create the polyline and add the symbol to it via the 'icons' property.
          // var line2 = new google.maps.Polyline({
          //   path: greenRouteData,
          //   strokeColor: "#0f0",
          //   strokeWeight: 15,
          //   map: map,
          // });

          // var path = {lat : DataArray.latitude, lng: DataArray.longitude}
          // console.log(path)
          // var origin = {
          //   lat: datas.data.origin_loc.latitude,
          //   lng: datas.data.origin_loc.longitude,
          // };
          // var destination = {
          //   lat: datas.data.tsp1_loc.latitude,
          //   lng: datas.data.tsp1_loc.longitude,
          // };
          // var destination2 = {
          //   lat: datas.data.tsp2_loc.latitude,
          //   lng: datas.data.tsp2_loc.longitude,
          // };
          // var destination3 = {
          //   lat: datas.data.dlv_loc.latitude,
          //   lng: datas.data.dlv_loc.longitude,
          // };
          // var destination4 = {
          //   lat: datas.data.pod_loc.latitude,
          //   lat: datas.data.pod_loc.latitude,
          //   lng: datas.data.pod_loc.longitude,
          // };

          // Create the polyline and add the symbol to it via the 'icons' property.
          var line = new google.maps.Polyline({
            path: pointArray,
            icons: [
              {
                icon: lineSymbol,
                offset: "100%",
              },
            ],
            scale: 2,
            // strokeColor: "#39b54a",
            strokeColor: "rgb(32, 172, 236)",
            strokeWeight: 4,
            strokeOpacity: 1.5,
            width: 8,
            map: map,
          });

          animateCircle(line);

          function animateCircle(line) {
            var count = 0;
            window.setInterval(function () {
              count = (count + 1) % 200;

              var icons = line.get("icons");
              icons[0].offset = count / 2 + "%";
              line.set("icons", icons);
            }, 30);
          }
      }
    </script>
    <script
      async
      defer
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAdUg5RYhac4wW-xnx-p0PrmKogycWz9pI&callback=initMap"
    ></script>
  </body>
</html>
